<!DOCTYPE html>
<html>

<head>
    <title>Webcam Video Delay</title>
</head>

<body>
    <h1>Webcam Video Delay</h1>

        <video id="webcam" autoplay></video>
        <canvas id="current-video"></canvas>
        <canvas id="delayed-video"></canvas>

    <script>
        // Get the webcam video stream
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                const videoEl = document.getElementById('webcam');
                videoEl.srcObject = stream;

                // Create a canvas to display the delayed video
                const currentCanvas = document.getElementById('current-video');
                const currentCtx = currentCanvas.getContext('2d', { willReadFrequently: true} );
                currentCtx.will

                const delayedCanvas = document.getElementById('delayed-video');
                const delayedCtx = delayedCanvas.getContext('2d');

                let w = 0;
                let h = 0;

                // Set canvas dimensions to match video
                videoEl.addEventListener('loadedmetadata', function () {
                    w = videoEl.videoWidth;
                    h = videoEl.videoHeight;

                    videoEl.width = w;
                    videoEl.height = w;

                    currentCanvas.width = w;
                    currentCanvas.height = h;

                    delayedCanvas.width = w;
                    delayedCanvas.height = h;

                    // Create a buffer to store frames
                    const buffer = [];
                    const bufferSize = 10; // Number of seconds to delay

                    console.log(w);
                    console.log(h);

                    // Function to process video frames
                    function processFrame() {
                        // Draw the current video frame on the canvas
                        currentCtx.drawImage(videoEl, 0, 0, w, h);

                        // Store the frame in the buffer
                        buffer.push(currentCtx.getImageData(0, 0, w, h));

                        // Remove frames older than the buffer size
                        if (buffer.length > bufferSize * 30) {
                            buffer.splice(0, buffer.length - bufferSize * 30);
                        }

                        // Schedule the next frame processing
                        requestAnimationFrame(processFrame);
                    };

                    processFrame();

                    function drawBuffer() {
                        if (buffer.length == bufferSize * 30) {
                            const imgData = buffer.shift()
                            delayedCtx.putImageData(imgData, 0, 0);
                        }

                        // Schedule the next frame processing
                        requestAnimationFrame(drawBuffer);
                    };

                    drawBuffer();
                });
            })
            .catch(function (error) {
                console.error('Error accessing webcam:', error);
            });
    </script>
</body>

</html>