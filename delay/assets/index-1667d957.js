(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();const y=({el:n,variable:e,onChecked:s,onUnchecked:a})=>{const t=()=>{e.get()?(console.log("checked"),s()):(console.log("unchecked"),a())};n.checked=e.get(),t(),n.addEventListener("input",()=>{e.set(n.checked),console.log(e.get()),t()})};class u{constructor(e,s){this.key=e,this.initial=s}set(e){localStorage.setItem(this.key,JSON.stringify(e))}get(){const e=localStorage.getItem(this.key);return e===null?this.initial:JSON.parse(e)}}const b=new u("delayInMs",4e3),h=document.getElementById("delay-in-ms");h.value=b.get().toString();h.onchange=()=>{b.set(h.valueAsNumber),h.blur(),E()};const x=document.getElementById("grid"),c=document.getElementById("webcam"),l=document.getElementById("data"),i=document.getElementById("delayed-video-video"),S=document.getElementById("menu-button"),R=document.getElementById("settings");S.addEventListener("click",()=>{R.classList.toggle("hidden"),S.classList.toggle("change")});y({el:document.getElementById("toggle-mirror"),variable:new u("mirrored",!0),onChecked:()=>{c.classList.add("mirror"),i.classList.add("mirror")},onUnchecked:()=>{c.classList.remove("mirror"),i.classList.remove("mirror")}});y({el:document.getElementById("toggle-grid"),variable:new u("grid",!0),onChecked:()=>x.classList.remove("hidden"),onUnchecked:()=>x.classList.add("hidden")});y({el:document.getElementById("toggle-feed"),variable:new u("toggleFeed",!1),onChecked:()=>c.classList.remove("hidden"),onUnchecked:()=>c.classList.add("hidden")});y({el:document.getElementById("toggle-data"),variable:new u("toggle-data",!0),onChecked:()=>l.classList.remove("hidden"),onUnchecked:()=>l.classList.add("hidden")});function $(){const n=i.getBoundingClientRect();c.style.width=`${.2*n.width}px`,c.style.height=`${.2*n.height}px`}new ResizeObserver($).observe(i);i.ondblclick=()=>{document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen()};const I=document.getElementById("resolution-select"),A=window.screen.width*window.devicePixelRatio,C=window.screen.height*window.devicePixelRatio,P=[{name:"720p",w:1280,h:720},{name:"1080p",w:1920,h:1080},{name:"1440p",w:2560,h:1440},{name:"4k",w:3840,h:2160},{name:"Screen resolution",w:A,h:C}],p=new u("resolutionAttempt",P[1]);P.map(n=>{const e=document.createElement("option");e.innerText=n.name,e.value=JSON.stringify(n),I.appendChild(e),e.value===JSON.stringify(p.get())&&e.setAttribute("selected","selected")});I.oninput=async()=>{p.set(JSON.parse(I.value)),await E()};let k=T(p.get());async function E(){l.innerText="getting webcam information",(await k)(),k=T(p.get())}function O(){if(/Android.+Firefox\//.test(navigator.userAgent)){i.style.transform=`rotate(${window.screen.orientation.angle}deg)`;const e=window.screen.orientation.angle%180!==0;i.style.width=e?"100vh":"100vw",i.style.height=e?"100vw":"100vh"}}O();window.screen.orientation.onchange=async()=>{await E(),O()};async function T(n){const e=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:{ideal:n.w},height:{ideal:n.h},resizeMode:{exact:"none"},frameRate:{ideal:30}}}).catch(s=>{throw alert(s),s});return U(e)}function U(n){c.srcObject=n;const e=Date.now();let s;const a={Buffering:"buffering",Playing:"playing"};let t=a.Buffering;const o={mimeType:"video/webm;codecs=vp8"},d=new MediaSource;i.src=URL.createObjectURL(d),i.oncanplay=()=>{t===a.Buffering&&(t=a.Playing,s=Date.now())};let g;d.onsourceopen=()=>{d.duration=Number.POSITIVE_INFINITY,g=d.addSourceBuffer(o.mimeType),g.mode="sequence"};const w=[],v=new MediaRecorder(n,o);v.ondataavailable=r=>{w.push(r.data),L()},v.start(b.get());async function L(){if(d.readyState==="open"&&g.updating===!1&&w.length>0){const r=w.shift(),m=await(r==null?void 0:r.arrayBuffer());m&&g.appendBuffer(m)}}let f="calculating data...";c.onloadedmetadata=()=>f=`${c.videoWidth}x${c.videoHeight}`;function M(){if(t===a.Playing){const r=i.getVideoPlaybackQuality().totalVideoFrames;l.innerText=`${Number(r/(Date.now()-s)*1e3).toFixed(0)} fps | ${f}`}}let B;const N=setInterval(()=>{t===a.Buffering?l.innerText=`buffering: ${Date.now()-e}ms | ${f}`:(clearInterval(N),l.innerText=`calculating data... | ${f}`,B=setInterval(M,1e3))},100),D=setInterval(L,100),F=setInterval(()=>{const r=(Date.now()-s)/1e3,m=r-i.currentTime;Math.abs(m)>1&&(i.currentTime=r)},1e3);return()=>{[D,B,F].forEach(clearInterval),v.stop(),n.getTracks().forEach(r=>r.stop())}}
