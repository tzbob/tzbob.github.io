(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();const I=({el:n,variable:e,onChecked:s,onUnchecked:a})=>{const t=()=>{e.get()?(console.log("checked"),s()):(console.log("unchecked"),a())};n.checked=e.get(),t(),n.addEventListener("input",()=>{e.set(n.checked),console.log(e.get()),t()})};class u{constructor(e,s){this.key=e,this.initial=s}set(e){localStorage.setItem(this.key,JSON.stringify(e))}get(){const e=localStorage.getItem(this.key);return e===null?this.initial:JSON.parse(e)}}const b=new u("delayInMs",4e3),h=document.getElementById("delay-in-ms");h.value=b.get().toString();h.onchange=()=>{b.set(h.valueAsNumber),h.blur(),E()};const c=document.getElementById("webcam"),d=document.getElementById("data"),i=document.getElementById("delayed-video-video"),B=document.getElementById("menu-button"),F=document.getElementById("settings");B.addEventListener("click",()=>{F.classList.toggle("hidden"),B.classList.toggle("change")});I({el:document.getElementById("toggle-mirror"),variable:new u("mirrored",!0),onChecked:()=>{c.classList.add("mirror"),i.classList.add("mirror")},onUnchecked:()=>{c.classList.remove("mirror"),i.classList.remove("mirror")}});I({el:document.getElementById("toggle-feed"),variable:new u("toggleFeed",!1),onChecked:()=>c.classList.remove("hidden"),onUnchecked:()=>c.classList.add("hidden")});I({el:document.getElementById("toggle-data"),variable:new u("toggle-data",!0),onChecked:()=>d.classList.remove("hidden"),onUnchecked:()=>d.classList.add("hidden")});function R(){const n=i.getBoundingClientRect();c.style.width=`${.2*n.width}px`,c.style.height=`${.2*n.height}px`}new ResizeObserver(R).observe(i);i.ondblclick=()=>{document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen()};const v=document.getElementById("resolution-select"),$=window.screen.width*window.devicePixelRatio,A=window.screen.height*window.devicePixelRatio,P=[{name:"720p",w:1280,h:720},{name:"1080p",w:1920,h:1080},{name:"1440p",w:2560,h:1440},{name:"4k",w:3840,h:2160},{name:"Screen resolution",w:$,h:A}],y=new u("resolutionAttempt",P[1]);P.map(n=>{const e=document.createElement("option");e.innerText=n.name,e.value=JSON.stringify(n),v.appendChild(e),e.value===JSON.stringify(y.get())&&e.setAttribute("selected","selected")});v.oninput=async()=>{y.set(JSON.parse(v.value)),await E()};let S=O(y.get());async function E(){d.innerText="getting webcam information",(await S)(),S=O(y.get())}function k(){if(/Android.+Firefox\//.test(navigator.userAgent)){i.style.transform=`rotate(${window.screen.orientation.angle}deg)`;const e=window.screen.orientation.angle%180!==0;i.style.width=e?"100vh":"100vw",i.style.height=e?"100vw":"100vh"}}k();window.screen.orientation.onchange=async()=>{await E(),k()};async function O(n){const e=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:{ideal:n.w},height:{ideal:n.h},resizeMode:{exact:"none"},frameRate:{ideal:30}}}).catch(s=>{throw alert(s),s});return C(e)}function C(n){c.srcObject=n;const e=Date.now();let s;const a={Buffering:"buffering",Playing:"playing"};let t=a.Buffering;const o={mimeType:"video/webm;codecs=vp8"},l=new MediaSource;i.src=URL.createObjectURL(l),i.oncanplay=()=>{t===a.Buffering&&(t=a.Playing,s=Date.now())};let f;l.onsourceopen=()=>{l.duration=Number.POSITIVE_INFINITY,f=l.addSourceBuffer(o.mimeType),f.mode="sequence"};const p=[],w=new MediaRecorder(n,o);w.ondataavailable=r=>{p.push(r.data),L()},w.start(b.get());async function L(){if(l.readyState==="open"&&f.updating===!1&&p.length>0){const r=p.shift(),m=await(r==null?void 0:r.arrayBuffer());m&&f.appendBuffer(m)}}let g="calculating data...";c.onloadedmetadata=()=>g=`${c.videoWidth}x${c.videoHeight}`;function T(){if(t===a.Playing){const r=i.getVideoPlaybackQuality().totalVideoFrames;d.innerText=`${Number(r/(Date.now()-s)*1e3).toFixed(0)} fps | ${g}`}}let x;const M=setInterval(()=>{t===a.Buffering?d.innerText=`buffering: ${Date.now()-e}ms | ${g}`:(clearInterval(M),d.innerText=`calculating data... | ${g}`,x=setInterval(T,1e3))},100),N=setInterval(L,100),D=setInterval(()=>{const r=(Date.now()-s)/1e3,m=r-i.currentTime;Math.abs(m)>1&&(i.currentTime=r)},1e3);return()=>{[N,x,D].forEach(clearInterval),w.stop(),n.getTracks().forEach(r=>r.stop())}}
