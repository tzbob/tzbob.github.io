(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const g of t.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function c(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(e){if(e.ep)return;e.ep=!0;const t=c(e);fetch(e.href,t)}})();const w=i=>n=>c=>{function l(){i.checked?n():c()}l(),i.addEventListener("input",l)};let m=2e3;const f=document.getElementById("delay-in-ms");f.value=m.toString();f.onchange=()=>{m=f.valueAsNumber,f.blur()};const r=document.getElementById("delayed-video"),T=r.getContext("2d"),o=document.getElementById("webcam"),u=document.getElementById("data"),L=document.getElementById("menu-button"),N=document.getElementById("settings");L.addEventListener("click",()=>{N.classList.toggle("hidden"),L.classList.toggle("change")});const $=document.getElementById("toggle-mirror");w($)(()=>{o.classList.add("mirror"),r.classList.add("mirror")})(()=>{o.classList.remove("mirror"),r.classList.remove("mirror")});const P=document.getElementById("toggle-feed");w(P)(()=>o.classList.remove("hidden"))(()=>o.classList.add("hidden"));const S=document.getElementById("toggle-data");w(S)(()=>u.classList.remove("hidden"))(()=>u.classList.add("hidden"));function A(){const i=r.getBoundingClientRect();o.style.width=`${.2*i.width}px`,o.style.height=`${.2*i.height}px`}new ResizeObserver(A).observe(r);r.ondblclick=()=>{document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen()};const h=document.getElementById("resolution-select"),R=window.screen.width*window.devicePixelRatio,q=window.screen.height*window.devicePixelRatio,F=[{name:"720p",w:1280,h:720},{name:"1080p",w:1920,h:1080},{name:"1440p",w:2560,h:1440},{name:"4k",w:3840,h:2160},{name:"Screen resolution",w:R,h:q}];let p=F[0];F.map(i=>{const n=document.createElement("option");n.innerText=i.name,n.value=JSON.stringify(i),h.appendChild(n)});h.oninput=async()=>{p=JSON.parse(h.value),B()};let I=D(p);async function B(){(await I)(),u.innerText="getting webcam information",I=D(p)}function C(){if(/Android.+Firefox\//.test(navigator.userAgent)){r.style.transform=`rotate(${window.screen.orientation.angle}deg)`;const n=window.screen.orientation.angle%180!==0;r.style.width=n?"100vh":"100vw",r.style.height=n?"100vw":"100vh"}}C();window.screen.orientation.onchange=()=>{B(),C()};async function D(i){let n=!0;u.innerText="getting webcam information";const c=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:{ideal:i.w},height:{ideal:i.h},resizeMode:{exact:"none"},frameRate:{ideal:30}}});o.srcObject=c;let l;return o.onloadedmetadata=()=>{let e=o.videoWidth,t=o.videoHeight;r.width=e,r.height=t;const y=new OffscreenCanvas(e,t).getContext("2d",{willReadFrequently:!0}),v=1e3/30,O=2*v,s=[];function M(){const a=Date.now()-s[0].time;let d="";a+O<=m&&(d=`buffering: ${a}ms | `),d+=`${e}x${t} | ${Number(e*t*s.length*4/1024/1024/1024).toFixed(1)}GB | ${Number(s.length/a*1e3).toFixed(0)} fps`,u.innerText=d}l=setInterval(M,500);let E=Date.now();function x(){const a=Date.now(),d=a-E;if(y.drawImage(o,0,0,e,t),d*1.15>v&&(E=a,s.push({time:a,image:y.getImageData(0,0,e,t)})),s.length>0){let b=!0;for(;b;)a-s[0].time>=m?s.shift():b=!1;a-s[0].time<m&&T.putImageData(s[0].image,0,0)}n&&requestAnimationFrame(x)}x()},()=>{clearInterval(l),n=!1,c.getTracks().forEach(e=>e.stop())}}
