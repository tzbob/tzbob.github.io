(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function a(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=a(e);fetch(e.href,o)}})();const v=t=>n=>a=>{function s(){t.checked?n():a()}s(),t.addEventListener("input",s)};let b=2e3;const g=document.getElementById("delay-in-ms");g.value=b.toString();g.onchange=()=>{b=g.valueAsNumber,g.blur(),E()};const i=document.getElementById("delayed-video-video"),c=document.getElementById("webcam"),d=document.getElementById("data"),x=document.getElementById("menu-button"),N=document.getElementById("settings");x.addEventListener("click",()=>{N.classList.toggle("hidden"),x.classList.toggle("change")});const R=document.getElementById("toggle-mirror");v(R)(()=>{c.classList.add("mirror"),i.classList.add("mirror")})(()=>{c.classList.remove("mirror"),i.classList.remove("mirror")});const $=document.getElementById("toggle-feed");v($)(()=>c.classList.remove("hidden"))(()=>c.classList.add("hidden"));const A=document.getElementById("toggle-data");v(A)(()=>d.classList.remove("hidden"))(()=>d.classList.add("hidden"));function V(){const t=i.getBoundingClientRect();c.style.width=`${.2*t.width}px`,c.style.height=`${.2*t.height}px`}new ResizeObserver(V).observe(i);i.ondblclick=()=>{document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen()};const w=document.getElementById("resolution-select"),W=window.screen.width*window.devicePixelRatio,k=window.screen.height*window.devicePixelRatio,P=[{name:"720p",w:1280,h:720},{name:"1080p",w:1920,h:1080},{name:"1440p",w:2560,h:1440},{name:"4k",w:3840,h:2160},{name:"Screen resolution",w:W,h:k}];let h=P[1];P.map(t=>{const n=document.createElement("option");n.innerText=t.name,n.value=JSON.stringify(t),w.appendChild(n),t===h&&n.setAttribute("selected","selected")});w.oninput=async()=>{h=JSON.parse(w.value),await E()};let B=S(h);async function E(){d.innerText="getting webcam information",(await B)(),B=S(h)}function T(){if(/Android.+Firefox\//.test(navigator.userAgent)){i.style.transform=`rotate(${window.screen.orientation.angle}deg)`;const n=window.screen.orientation.angle%180!==0;i.style.width=n?"100vh":"100vw",i.style.height=n?"100vw":"100vh"}}T();window.screen.orientation.onchange=async()=>{await E(),T()};async function S(t){const n=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:{ideal:t.w},height:{ideal:t.h},resizeMode:{exact:"none"},frameRate:{ideal:30}}}).catch(a=>{throw alert(a),a});return q(n)}function q(t){c.srcObject=t;const n=Date.now();let a;const s={Buffering:"buffering",Playing:"playing"};let e=s.Buffering;const o={mimeType:"video/webm;codecs=vp8"},l=new MediaSource;i.src=URL.createObjectURL(l),i.oncanplay=()=>{e===s.Buffering&&(e=s.Playing,a=Date.now())};let f;l.onsourceopen=()=>{l.duration=Number.POSITIVE_INFINITY,f=l.addSourceBuffer(o.mimeType),f.mode="sequence"};const y=[],p=new MediaRecorder(t,o);p.ondataavailable=r=>{y.push(r.data),I()},p.start(b);async function I(){if(l.readyState==="open"&&f.updating===!1&&y.length>0){const r=y.shift(),u=await(r==null?void 0:r.arrayBuffer());u&&f.appendBuffer(u)}}let m="calculating data...";c.onloadedmetadata=()=>m=`${c.videoWidth}x${c.videoHeight}`;function D(){if(e===s.Playing){const r=i.getVideoPlaybackQuality().totalVideoFrames;d.innerText=`${Number(r/(Date.now()-a)*1e3).toFixed(0)} fps | ${m}`}}let L;const M=setInterval(()=>{e===s.Buffering?d.innerText=`buffering: ${Date.now()-n}ms | ${m}`:(clearInterval(M),d.innerText=`calculating data... | ${m}`,L=setInterval(D,1e3))},100),O=setInterval(I,100),F=setInterval(()=>{const r=(Date.now()-a)/1e3,u=r-i.currentTime;Math.abs(u)>1&&(i.currentTime=r),console.log(u)},1e3);return()=>{[O,L,F].forEach(clearInterval),p.stop(),t.getTracks().forEach(r=>r.stop())}}
