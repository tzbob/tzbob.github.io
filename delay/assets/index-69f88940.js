(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function c(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=c(e);fetch(e.href,t)}})();let f=2e3;const g=document.getElementById("delay-in-ms");g.value=f.toString();g.onchange=()=>f=g.valueAsNumber;const i=document.getElementById("delayed-video"),C=i.getContext("2d",{alpha:!0,depth:!1,antialias:!1}),n=document.getElementById("webcam"),m=document.getElementById("data"),F=document.getElementById("menu-button"),O=document.getElementById("settings");F.addEventListener("click",()=>O.classList.toggle("hidden"));const E=document.getElementById("toggle-mirror");E.addEventListener("input",()=>{E.checked?(n.classList.add("mirror"),i.classList.add("mirror")):(n.classList.remove("mirror"),i.classList.remove("mirror"))});const b=document.getElementById("toggle-feed");b.addEventListener("input",()=>{b.checked?n.classList.add("hidden"):n.classList.remove("hidden")});function T(){const s=i.getBoundingClientRect();n.style.width=`${.2*s.width}px`,n.style.height=`${.2*s.height}px`}new ResizeObserver(T).observe(i);i.ondblclick=()=>{document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen()};let L=I();window.screen.orientation.onchange=async()=>{(await L)(),m.innerText="getting webcam information",L=I()};async function I(){let s=!0;m.innerText="getting webcam information";const r=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:{ideal:window.screen.width},height:{ideal:window.screen.height},resizeMode:{exact:"none"}}}),c=r.getVideoTracks()[0].getSettings();n.srcObject=r;let o=c.width,e=c.height;i.width=o,i.height=e;const a=new OffscreenCanvas(o,e).getContext("2d",{willReadFrequently:!0,alpha:!1,depth:!1,antialias:!1});return n.onloadedmetadata=()=>{const d=1e3/c.frameRate,l=[];let x=Date.now();function h(){const u=Date.now(),B=u-x;a.drawImage(n,0,0,o,e),B*2>=d&&l.push({time:u,image:a.getImageData(0,0,o,e)});const p=2*d;if(l.length>0){let y=!0;for(;y;)u-l[0].time-p>=f?l.shift():y=!1;const w=l[0],v=u-w.time;v+p<=f?m.innerText=`buffering: ${v}ms`:(C.putImageData(w.image,0,0),m.innerText="")}s&&requestAnimationFrame(h)}h()},()=>{s=!1,r.getTracks().forEach(d=>d.stop())}}
