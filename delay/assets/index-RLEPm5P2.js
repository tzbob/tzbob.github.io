var ye=Object.defineProperty;var we=(e,t,n)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var h=(e,t,n)=>(we(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const P=({el:e,variable:t,onChecked:n,onUnchecked:r})=>{const i=()=>{t.get()?(console.log("checked"),n()):(console.log("unchecked"),r())};e.checked=t.get(),i(),e.addEventListener("input",()=>{t.set(e.checked),console.log(t.get()),i()})};class v{constructor(t,n){this.key=t,this.initial=n}set(t){localStorage.setItem(this.key,JSON.stringify(t))}get(){const t=localStorage.getItem(this.key);return t===null?this.initial:JSON.parse(t)}}function Ee(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),t&&(r.href=t),i.href=e,i.href}const ve=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function y(e){const t=[];for(let n=0,r=e.length;n<r;n++)t.push(e[n]);return t}function I(e,t){const r=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return r?parseFloat(r.replace("px","")):0}function Se(e){const t=I(e,"border-left-width"),n=I(e,"border-right-width");return e.clientWidth+t+n}function be(e){const t=I(e,"border-top-width"),n=I(e,"border-bottom-width");return e.clientHeight+t+n}function se(e,t={}){const n=t.width||Se(e),r=t.height||be(e);return{width:n,height:r}}function xe(){let e,t;try{t=process}catch{}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const p=16384;function Re(e){(e.width>p||e.height>p)&&(e.width>p&&e.height>p?e.width>e.height?(e.height*=p/e.width,e.width=p):(e.width*=p/e.height,e.height=p):e.width>p?(e.height*=p/e.width,e.width=p):(e.width*=p/e.height,e.height=p))}function Le(e,t={}){return e.toBlob?new Promise(n=>{e.toBlob(n,t.type?t.type:"image/png",t.quality?t.quality:1)}):new Promise(n=>{const r=window.atob(e.toDataURL(t.type?t.type:void 0,t.quality?t.quality:void 0).split(",")[1]),i=r.length,s=new Uint8Array(i);for(let o=0;o<i;o+=1)s[o]=r.charCodeAt(o);n(new Blob([s],{type:t.type?t.type:"image/png"}))})}function k(e){return new Promise((t,n)=>{const r=new Image;r.decode=()=>t(r),r.onload=()=>t(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="async",r.src=e})}async function Te(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function Ie(e,t,n){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),s=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${t}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${t} ${n}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),i.appendChild(s),s.appendChild(e),Te(i)}const m=(e,t)=>{if(e instanceof t)return!0;const n=Object.getPrototypeOf(e);return n===null?!1:n.constructor.name===t.name||m(n,t)};function ke(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function Ce(e){return y(e).map(t=>{const n=e.getPropertyValue(t),r=e.getPropertyPriority(t);return`${t}: ${n}${r?" !important":""};`}).join(" ")}function Fe(e,t,n){const r=`.${e}:${t}`,i=n.cssText?ke(n):Ce(n);return document.createTextNode(`${r}{${i}}`)}function Y(e,t,n){const r=window.getComputedStyle(e,n),i=r.getPropertyValue("content");if(i===""||i==="none")return;const s=ve();try{t.className=`${t.className} ${s}`}catch{return}const o=document.createElement("style");o.appendChild(Fe(s,n,r)),t.appendChild(o)}function Pe(e,t){Y(e,t,":before"),Y(e,t,":after")}const Q="application/font-woff",Z="image/jpeg",Ae={woff:Q,woff2:Q,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Z,jpeg:Z,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Me(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function W(e){const t=Me(e).toLowerCase();return Ae[t]||""}function $e(e){return e.split(/,/)[1]}function V(e){return e.search(/^(data:)/)!==-1}function oe(e,t){return`data:${t};base64,${e}`}async function ae(e,t,n){const r=await fetch(e,t);if(r.status===404)throw new Error(`Resource "${r.url}" not found`);const i=await r.blob();return new Promise((s,o)=>{const a=new FileReader;a.onerror=o,a.onloadend=()=>{try{s(n({res:r,result:a.result}))}catch(c){o(c)}},a.readAsDataURL(i)})}const B={};function Be(e,t,n){let r=e.replace(/\?.*/,"");return n&&(r=e),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),t?`[${t}]${r}`:r}async function _(e,t,n){const r=Be(e,t,n.includeQueryParams);if(B[r]!=null)return B[r];n.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let i;try{const s=await ae(e,n.fetchRequestInit,({res:o,result:a})=>(t||(t=o.headers.get("Content-Type")||""),$e(a)));i=oe(s,t)}catch(s){i=n.imagePlaceholder||"";let o=`Failed to fetch resource: ${e}`;s&&(o=typeof s=="string"?s:s.message),o&&console.warn(o)}return B[r]=i,i}async function Ve(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):k(t)}async function Oe(e,t){if(e.currentSrc){const s=document.createElement("canvas"),o=s.getContext("2d");s.width=e.clientWidth,s.height=e.clientHeight,o==null||o.drawImage(e,0,0,s.width,s.height);const a=s.toDataURL();return k(a)}const n=e.poster,r=W(n),i=await _(n,r,t);return k(i)}async function Ue(e){var t;try{if(!((t=e==null?void 0:e.contentDocument)===null||t===void 0)&&t.body)return await A(e.contentDocument.body,{},!0)}catch{}return e.cloneNode(!1)}async function De(e,t){return m(e,HTMLCanvasElement)?Ve(e):m(e,HTMLVideoElement)?Oe(e,t):m(e,HTMLIFrameElement)?Ue(e):e.cloneNode(!1)}const He=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";async function je(e,t,n){var r,i;let s=[];return He(e)&&e.assignedNodes?s=y(e.assignedNodes()):m(e,HTMLIFrameElement)&&(!((r=e.contentDocument)===null||r===void 0)&&r.body)?s=y(e.contentDocument.body.childNodes):s=y(((i=e.shadowRoot)!==null&&i!==void 0?i:e).childNodes),s.length===0||m(e,HTMLVideoElement)||await s.reduce((o,a)=>o.then(()=>A(a,n)).then(c=>{c&&t.appendChild(c)}),Promise.resolve()),t}function We(e,t){const n=t.style;if(!n)return;const r=window.getComputedStyle(e);r.cssText?(n.cssText=r.cssText,n.transformOrigin=r.transformOrigin):y(r).forEach(i=>{let s=r.getPropertyValue(i);i==="font-size"&&s.endsWith("px")&&(s=`${Math.floor(parseFloat(s.substring(0,s.length-2)))-.1}px`),m(e,HTMLIFrameElement)&&i==="display"&&s==="inline"&&(s="block"),i==="d"&&t.getAttribute("d")&&(s=`path(${t.getAttribute("d")})`),n.setProperty(i,s,r.getPropertyPriority(i))})}function _e(e,t){m(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),m(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function qe(e,t){if(m(e,HTMLSelectElement)){const n=t,r=Array.from(n.children).find(i=>e.value===i.getAttribute("value"));r&&r.setAttribute("selected","")}}function ze(e,t){return m(t,Element)&&(We(e,t),Pe(e,t),_e(e,t),qe(e,t)),t}async function Ge(e,t){const n=e.querySelectorAll?e.querySelectorAll("use"):[];if(n.length===0)return e;const r={};for(let s=0;s<n.length;s++){const a=n[s].getAttribute("xlink:href");if(a){const c=e.querySelector(a),l=document.querySelector(a);!c&&l&&!r[a]&&(r[a]=await A(l,t,!0))}}const i=Object.values(r);if(i.length){const s="http://www.w3.org/1999/xhtml",o=document.createElementNS(s,"svg");o.setAttribute("xmlns",s),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const a=document.createElementNS(s,"defs");o.appendChild(a);for(let c=0;c<i.length;c++)a.appendChild(i[c]);e.appendChild(o)}return e}async function A(e,t,n){return!n&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(r=>De(r,t)).then(r=>je(e,r,t)).then(r=>ze(e,r)).then(r=>Ge(r,t))}const ce=/url\((['"]?)([^'"]+?)\1\)/g,Je=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Xe=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Ke(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Ye(e){const t=[];return e.replace(ce,(n,r,i)=>(t.push(i),n)),t.filter(n=>!V(n))}async function Qe(e,t,n,r,i){try{const s=n?Ee(t,n):t,o=W(t);let a;if(i){const c=await i(s);a=oe(c,o)}else a=await _(s,o,r);return e.replace(Ke(t),`$1${a}$3`)}catch{}return e}function Ze(e,{preferredFontFormat:t}){return t?e.replace(Xe,n=>{for(;;){const[r,,i]=Je.exec(n)||[];if(!i)return"";if(i===t)return`src: ${r};`}}):e}function le(e){return e.search(ce)!==-1}async function de(e,t,n){if(!le(e))return e;const r=Ze(e,n);return Ye(r).reduce((s,o)=>s.then(a=>Qe(a,o,t,n)),Promise.resolve(r))}async function R(e,t,n){var r;const i=(r=t.style)===null||r===void 0?void 0:r.getPropertyValue(e);if(i){const s=await de(i,null,n);return t.style.setProperty(e,s,t.style.getPropertyPriority(e)),!0}return!1}async function Ne(e,t){await R("background",e,t)||await R("background-image",e,t),await R("mask",e,t)||await R("mask-image",e,t)}async function et(e,t){const n=m(e,HTMLImageElement);if(!(n&&!V(e.src))&&!(m(e,SVGImageElement)&&!V(e.href.baseVal)))return;const r=n?e.src:e.href.baseVal,i=await _(r,W(r),t);await new Promise((s,o)=>{e.onload=s,e.onerror=o;const a=e;a.decode&&(a.decode=s),a.loading==="lazy"&&(a.loading="eager"),n?(e.srcset="",e.src=i):e.href.baseVal=i})}async function tt(e,t){const r=y(e.childNodes).map(i=>ue(i,t));await Promise.all(r).then(()=>e)}async function ue(e,t){m(e,Element)&&(await Ne(e,t),await et(e,t),await tt(e,t))}function nt(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const r=t.style;return r!=null&&Object.keys(r).forEach(i=>{n[i]=r[i]}),e}const N={};async function ee(e){let t=N[e];if(t!=null)return t;const r=await(await fetch(e)).text();return t={url:e,cssText:r},N[e]=t,t}async function te(e,t){let n=e.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,s=(n.match(/url\([^)]+\)/g)||[]).map(async o=>{let a=o.replace(r,"$1");return a.startsWith("https://")||(a=new URL(a,e.url).href),ae(a,t.fetchRequestInit,({result:c})=>(n=n.replace(o,`url(${c})`),[o,c]))});return Promise.all(s).then(()=>n)}function ne(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=e.replace(n,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=i.exec(r);if(c===null)break;t.push(c[0])}r=r.replace(i,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(o,"gi");for(;;){let c=s.exec(r);if(c===null){if(c=a.exec(r),c===null)break;s.lastIndex=a.lastIndex}else a.lastIndex=s.lastIndex;t.push(c[0])}return t}async function rt(e,t){const n=[],r=[];return e.forEach(i=>{if("cssRules"in i)try{y(i.cssRules||[]).forEach((s,o)=>{if(s.type===CSSRule.IMPORT_RULE){let a=o+1;const c=s.href,l=ee(c).then(d=>te(d,t)).then(d=>ne(d).forEach(f=>{try{i.insertRule(f,f.startsWith("@import")?a+=1:i.cssRules.length)}catch(u){console.error("Error inserting rule from remote css",{rule:f,error:u})}})).catch(d=>{console.error("Error loading remote css",d.toString())});r.push(l)}})}catch(s){const o=e.find(a=>a.href==null)||document.styleSheets[0];i.href!=null&&r.push(ee(i.href).then(a=>te(a,t)).then(a=>ne(a).forEach(c=>{o.insertRule(c,i.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",s)}}),Promise.all(r).then(()=>(e.forEach(i=>{if("cssRules"in i)try{y(i.cssRules||[]).forEach(s=>{n.push(s)})}catch(s){console.error(`Error while reading CSS rules from ${i.href}`,s)}}),n))}function it(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>le(t.style.getPropertyValue("src")))}async function st(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const n=y(e.ownerDocument.styleSheets),r=await rt(n,t);return it(r)}async function ot(e,t){const n=await st(e,t);return(await Promise.all(n.map(i=>{const s=i.parentStyleSheet?i.parentStyleSheet.href:null;return de(i.cssText,s,t)}))).join(`
`)}async function at(e,t){const n=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await ot(e,t);if(n){const r=document.createElement("style"),i=document.createTextNode(n);r.appendChild(i),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r)}}async function ct(e,t={}){const{width:n,height:r}=se(e,t),i=await A(e,t,!0);return await at(i,t),await ue(i,t),nt(i,t),await Ie(i,n,r)}async function lt(e,t={}){const{width:n,height:r}=se(e,t),i=await ct(e,t),s=await k(i),o=document.createElement("canvas"),a=o.getContext("2d"),c=t.pixelRatio||xe(),l=t.canvasWidth||n,d=t.canvasHeight||r;return o.width=l*c,o.height=d*c,t.skipAutoScale||Re(o),o.style.width=`${l}`,o.style.height=`${d}`,t.backgroundColor&&(a.fillStyle=t.backgroundColor,a.fillRect(0,0,o.width,o.height)),a.drawImage(s,0,0,o.width,o.height),o}async function dt(e,t={}){const n=await lt(e,t);return await Le(n)}var b=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},he={exports:{}};(function(e,t){(function(n,r){r()})(b,function(){function n(l,d){return typeof d>"u"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function r(l,d,f){var u=new XMLHttpRequest;u.open("GET",l),u.responseType="blob",u.onload=function(){c(u.response,d,f)},u.onerror=function(){console.error("could not download file")},u.send()}function i(l){var d=new XMLHttpRequest;d.open("HEAD",l,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function s(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(d)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof b=="object"&&b.global===b?b:void 0,a=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(l,d,f){var u=o.URL||o.webkitURL,g=document.createElement("a");d=d||l.name||"download",g.download=d,g.rel="noopener",typeof l=="string"?(g.href=l,g.origin===location.origin?s(g):i(g.href)?r(l,d,f):s(g,g.target="_blank")):(g.href=u.createObjectURL(l),setTimeout(function(){u.revokeObjectURL(g.href)},4e4),setTimeout(function(){s(g)},0))}:"msSaveOrOpenBlob"in navigator?function(l,d,f){if(d=d||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(n(l,f),d);else if(i(l))r(l,d,f);else{var u=document.createElement("a");u.href=l,u.target="_blank",setTimeout(function(){s(u)})}}:function(l,d,f,u){if(u=u||open("","_blank"),u&&(u.document.title=u.document.body.innerText="downloading..."),typeof l=="string")return r(l,d,f);var g=l.type==="application/octet-stream",pe=/constructor/i.test(o.HTMLElement)||o.safari,X=/CriOS\/[\d]+/.test(navigator.userAgent);if((X||g&&pe||a)&&typeof FileReader<"u"){var M=new FileReader;M.onloadend=function(){var S=M.result;S=X?S:S.replace(/^data:[^;]*;/,"data:attachment/file;"),u?u.location.href=S:location=S,u=null},M.readAsDataURL(l)}else{var K=o.URL||o.webkitURL,$=K.createObjectURL(l);u?u.location=$:location.href=$,u=null,setTimeout(function(){K.revokeObjectURL($)},4e4)}});o.saveAs=c.saveAs=c,e.exports=c})})(he);var ut=he.exports;class ht{constructor(t,n){h(this,"frames",0);h(this,"skipScroll",!1);h(this,"onScroll",()=>{if(this.skipScroll){this.skipScroll=!1;return}this.onFrameSelect(this.selectedFrame())});this.scroller=t,this.onFrameSelect=n}currentFrameHeight(){return this.scroller.scrollHeight/this.frames}selectedFrame(){return Math.round(this.scroller.scrollTop/this.currentFrameHeight())}wipeChildren(){for(;this.scroller.firstChild;)this.scroller.removeChild(this.scroller.firstChild)}selectFrame(t){if(this.selectedFrame()!==t){const n=this.currentFrameHeight()*t;this.skipScroll=!0,this.scroller.scrollTo({top:n,behavior:"instant"})}}setMaxFrames(t){if(t!==this.frames){this.frames=t,this.wipeChildren();let n=new Array(t).fill(0).map(r=>document.createElement("hr"));this.scroller.append(...n)}}start(){this.scroller.classList.remove("hidden"),this.scroller.addEventListener("scroll",this.onScroll)}stop(){this.scroller.classList.add("hidden"),this.scroller.removeEventListener("scroll",this.onScroll)}}class ft{constructor(t,n,r,i,s){h(this,"frameLength");h(this,"frameScroller");h(this,"interval");h(this,"onVideoClick",()=>this.videoEl.paused?this.videoEl.play():this.videoEl.pause());h(this,"pauseIfPlaying",()=>{this.videoEl.paused||this.videoEl.pause()});h(this,"onWheel",t=>this.onDeltaY(t.deltaY));h(this,"onDeltaY",t=>{this.videoEl.seeking||(this.pauseIfPlaying(),this.videoEl.currentTime=Math.min(Math.max(0,this.videoEl.currentTime+parseFloat((Math.sign(t)*this.frameLength).toFixed(5))),this.videoEl.duration))});h(this,"trackTime",()=>{var t;this.videoEl.paused||(t=this.frameScroller)==null||t.selectFrame(this.timeInSecondToFrame(this.videoEl.currentTime))});this.videoEl=t,this.expectedFps=n,this.onStart=i,this.onStop=s,this.frameLength=1/this.expectedFps,this.frameScroller=new ht(r,o=>{this.videoEl.seeking||(this.videoEl.currentTime=this.frameToTimeInSeconds(o))})}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}timeInSecondToFrame(t){return Math.ceil(t/this.frameLength)}frameToTimeInSeconds(t){return t*this.frameLength}start(){var r,i;this.pauseIfPlaying(),this.onStart();const t=this.videoEl.seekable.start(0),n=this.videoEl.seekable.end(0);(r=this.frameScroller)==null||r.setMaxFrames(this.timeInSecondToFrame(n-t)),(i=this.frameScroller)==null||i.start(),this.trackTime(),this.interval=setInterval(this.trackTime,100),this.videoEl.addEventListener("click",this.onVideoClick)}stop(){var t;this.onStop(),(t=this.frameScroller)==null||t.stop(),this.videoEl.removeEventListener("click",this.onVideoClick),clearInterval(this.interval)}}class mt{constructor(t,n,r,i,s){h(this,"pointedAt");h(this,"delayInMs");h(this,"dataEl");h(this,"videoEl");h(this,"delayedVideoEl");h(this,"stopAll");this.pointedAt=t,this.delayInMs=n,this.dataEl=r,this.videoEl=i,this.delayedVideoEl=s}findSupportedMediaType(){const t='video/webm; codecs="vp8"',n='video/mp4; codecs="avc1"';if(MediaRecorder.isTypeSupported(t))return t;if(MediaRecorder.isTypeSupported(n))return n;throw"No supported mimetypes"}async openStream(t){const n=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:this.pointedAt.get(),width:{ideal:t.w},height:{ideal:t.h},resizeMode:{exact:"none"},frameRate:{min:30,max:60}}}).catch(i=>{throw alert(i),i});return{built:n,stop:async()=>{n.getTracks().forEach(i=>i.stop())}}}delayWithMediaRecorder(t){this.videoEl.srcObject=t;const n={mimeType:this.findSupportedMediaType(),videoBitsPerSecond:6e6},r=new MediaSource;this.delayedVideoEl.src=URL.createObjectURL(r),this.delayedVideoEl.oncanplay=()=>{this.delayedVideoEl.play(),this.delayedVideoEl.oncanplay=()=>{}};let i;r.onsourceopen=()=>{r.duration=Number.POSITIVE_INFINITY,i=r.addSourceBuffer(n.mimeType),i.mode="sequence"};const s=new MediaRecorder(t,n);s.ondataavailable=c=>{o(c.data)};async function o(c){for(;r.readyState!=="open"||i.updating;);const l=await(c==null?void 0:c.arrayBuffer());l&&i.appendBuffer(l)}const a=()=>new Promise((c,l)=>{s.ondataavailable=d=>{o(d.data).catch(l),c()},s.stop(),i.onupdateend=()=>r.endOfStream()});return s.start(this.delayInMs.get()),{built:r,stop:a}}driftFixLoop(t){if(this.delayedVideoEl.buffered.length===0)return;const n=this.delayedVideoEl.buffered.end(0),r=this.delayInMs.get()/1e3,i=this.delayedVideoEl.getVideoPlaybackQuality().totalVideoFrames/n;Math.abs(n-this.delayedVideoEl.currentTime)>r&&(this.delayedVideoEl.currentTime=n-r),this.dataEl.innerText=`${i.toFixed(0)} fps | ${t}`}async start(t){this.dataEl.innerText="buffering...";const n=await this.openStream(t),r=this.delayWithMediaRecorder(n.built),i=setInterval(()=>this.driftFixLoop(`${this.delayedVideoEl.videoWidth}x${this.delayedVideoEl.videoHeight}`),this.delayInMs.get());this.stopAll=async()=>{clearInterval(i),this.dataEl.innerText="",await n.stop(),await r.stop()}}async stop(){this.stopAll&&(await this.stopAll(),this.stopAll=void 0)}}const gt=document.getElementById("review"),q=new v("delayInMs",4e3),L=document.getElementById("delay-in-ms");L.value=q.get().toString();L.onchange=()=>{q.set(L.valueAsNumber),L.blur(),x()};const C=document.getElementById("grid"),E=document.getElementById("webcam"),O=document.getElementById("data"),w=document.getElementById("delayed-video-video"),U=document.getElementById("play"),D=document.getElementById("pause");U.onclick=async()=>{await J(),D.classList.remove("hidden"),U.classList.add("hidden")};D.onclick=async()=>{await me(),U.classList.remove("hidden"),D.classList.add("hidden")};const pt=document.getElementById("screenshot"),F=document.getElementById("backgrounded-container");pt.onclick=()=>{dt(F,{canvasWidth:w.videoWidth,canvasHeight:w.videoHeight,pixelRatio:1}).then(e=>{if(e===null)return alert("empty blob when saving");const t=new Date().toLocaleString()+"-delay.png";ut.saveAs(e,t)})};const T=new v("pointedAt","portrait"),yt=document.getElementById("flip");yt.onclick=()=>{T.get()==="portrait"?T.set("environment"):T.set("portrait"),x()};const re=document.getElementById("menu-button"),wt=document.getElementById("settings");re.addEventListener("click",()=>{wt.classList.toggle("hidden"),re.classList.toggle("change")});P({el:document.getElementById("toggle-mirror"),variable:new v("mirrored",!0),onChecked:()=>{E.classList.add("mirror"),F.classList.add("mirror")},onUnchecked:()=>{E.classList.remove("mirror"),F.classList.remove("mirror")}});const Et=new v("grid",!0);P({el:document.getElementById("toggle-grid"),variable:Et,onChecked:()=>C.classList.remove("hidden"),onUnchecked:()=>C.classList.add("hidden")});const vt=new v("toggleFeed",!1);P({el:document.getElementById("toggle-feed"),variable:vt,onChecked:()=>E.classList.remove("hidden"),onUnchecked:()=>E.classList.add("hidden")});const St=new v("toggle-data",!1);P({el:document.getElementById("toggle-data"),variable:St,onChecked:()=>O.classList.remove("hidden"),onUnchecked:()=>O.classList.add("hidden")});function bt(){const e=w.getBoundingClientRect();E.style.width=`${.2*e.width}px`,E.style.height=`${.2*e.height}px`}new ResizeObserver(bt).observe(w);F.ondblclick=()=>{const e=document.fullscreenElement??document.webkitFullscreenElement,t=document.exitFullscreen??document.webkitExitFullscreen,n=document.body.requestFullscreen??document.body.webkitRequestFullscreen;e?t.call(document):n.call(document.body)};const H=document.getElementById("resolution-select"),xt=window.screen.width*window.devicePixelRatio,Rt=window.screen.height*window.devicePixelRatio,fe=[{name:"720p",w:1280,h:720},{name:"1080p",w:1920,h:1080},{name:"1440p",w:2560,h:1440},{name:"4k",w:3840,h:2160},{name:"Screen resolution",w:xt,h:Rt}],z=new v("resolutionAttempt",fe[1]);fe.map(e=>{const t=document.createElement("option");t.innerText=e.name,t.value=JSON.stringify(e),H.appendChild(t),t.value===JSON.stringify(z.get())&&t.setAttribute("selected","selected")});H.oninput=async()=>{z.set(JSON.parse(H.value)),await x()};const G=new mt(T,q,O,E,w);J();async function J(){G.start(z.get()).catch(alert)}async function me(){await G.stop().catch(alert),ge.stop()}async function x(){await me(),J()}const ie=document.getElementById("delay-in-ms-input"),j=document.getElementById("close-scene"),ge=new ft(w,60,document.getElementById("scroller"),()=>{[j].forEach(e=>e.classList.remove("hidden")),[C,ie,E].forEach(e=>e.classList.add("hidden"))},async()=>{[j].forEach(e=>e.classList.add("hidden")),[C,ie,E].forEach(e=>e.classList.remove("hidden"))});j.onclick=()=>x().catch(alert);gt.onclick=async()=>{await G.stop(),ge.start()};function Lt(){const e=/Android.+Firefox\//.test(navigator.userAgent),t=/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>1;if(e||t){w.style.transform=`rotate(${window.screen.orientation.angle}deg)`;const n=window.screen.orientation.angle%180!==0;w.style.width=n?"100vh":"100vw",w.style.height=n?"100vw":"100vh"}}window.screen.orientation.onchange=async()=>{await x(),Lt()};
