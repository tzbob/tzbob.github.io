(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function l(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=l(e);fetch(e.href,o)}})();const v=t=>n=>l=>{function s(){t.checked?n():l()}s(),t.addEventListener("input",s)};let g=2e3;const m=document.getElementById("delay-in-ms");m.value=g.toString();m.onchange=()=>{g=m.valueAsNumber,m.blur(),b()};const i=document.getElementById("delayed-video-video"),c=document.getElementById("webcam"),d=document.getElementById("data"),L=document.getElementById("menu-button"),F=document.getElementById("settings");L.addEventListener("click",()=>{F.classList.toggle("hidden"),L.classList.toggle("change")});const N=document.getElementById("toggle-mirror");v(N)(()=>{c.classList.add("mirror"),i.classList.add("mirror")})(()=>{c.classList.remove("mirror"),i.classList.remove("mirror")});const R=document.getElementById("toggle-feed");v(R)(()=>c.classList.remove("hidden"))(()=>c.classList.add("hidden"));const $=document.getElementById("toggle-data");v($)(()=>d.classList.remove("hidden"))(()=>d.classList.add("hidden"));function A(){const t=i.getBoundingClientRect();c.style.width=`${.2*t.width}px`,c.style.height=`${.2*t.height}px`}new ResizeObserver(A).observe(i);i.ondblclick=()=>{document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen()};const w=document.getElementById("resolution-select"),V=window.screen.width*window.devicePixelRatio,W=window.screen.height*window.devicePixelRatio,B=[{name:"720p",w:1280,h:720},{name:"1080p",w:1920,h:1080},{name:"1440p",w:2560,h:1440},{name:"4k",w:3840,h:2160},{name:"Screen resolution",w:V,h:W}];let h=B[1];B.map(t=>{const n=document.createElement("option");n.innerText=t.name,n.value=JSON.stringify(t),w.appendChild(n),t===h&&n.setAttribute("selected","selected")});w.oninput=async()=>{h=JSON.parse(w.value),await b()};let x=P(h);async function b(){d.innerText="getting webcam information",(await x)(),x=P(h)}function T(){if(/Android.+Firefox\//.test(navigator.userAgent)){i.style.transform=`rotate(${window.screen.orientation.angle}deg)`;const n=window.screen.orientation.angle%180!==0;i.style.width=n?"100vh":"100vw",i.style.height=n?"100vw":"100vh"}}T();window.screen.orientation.onchange=async()=>{await b(),T()};async function P(t){const n=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:{ideal:t.w},height:{ideal:t.h},resizeMode:{exact:"none"},frameRate:{ideal:30}}});return k(n)}function k(t){c.srcObject=t;const n=Date.now();let l;const s={Buffering:"buffering",Playing:"playing"};let e=s.Buffering;const o={mimeType:"video/webm;codecs=vp8"},a=new MediaSource;i.src=URL.createObjectURL(a),i.onplay=()=>{e===s.Buffering&&(e=s.Playing,l=Date.now())};let u;a.onsourceopen=()=>{a.duration=Number.POSITIVE_INFINITY,u=a.addSourceBuffer(o.mimeType),u.mode="sequence"};const y=[],p=new MediaRecorder(t,o);p.ondataavailable=r=>{y.push(r.data),E()},p.start(g);async function E(){if(a.readyState==="open"&&u.updating===!1&&y.length>0){const r=y.shift(),f=await(r==null?void 0:r.arrayBuffer());f&&u.appendBuffer(f)}}function S(){if(e===s.Playing){const r=i.getVideoPlaybackQuality().totalVideoFrames;d.innerText=`${c.videoWidth}x${c.videoHeight} | ${Number(r/(Date.now()-l)*1e3).toFixed(0)} fps`}}let I;const M=setInterval(()=>{e===s.Buffering?d.innerText=`buffering video: ${Date.now()-n} / ${g} ms`:(clearInterval(M),d.innerText="calculating data...",I=setTimeout(()=>setInterval(S,1e3),1e3))},100),D=setInterval(E,100),O=setInterval(()=>{const r=(Date.now()-l)/1e3,f=r-i.currentTime;Math.abs(f)>1&&(i.currentTime=r)},1e3);return()=>{[D,I,O].forEach(clearInterval),p.stop(),t.getTracks().forEach(r=>r.stop())}}
